---
title: Integrate AWS Cognito with Web3Auth
image: "guides-banners/cognito.png"
description: Learn how to use Web3Auth with AWS Cognito
type: guide
tags: [plug and play, web, aws cognito, react, evm]
date: June 25, 2022
author: Web3Auth Team
communityPortalTopicId: 47
---

import TabItem from "@theme/TabItem";
import Tabs from "@theme/Tabs";

import SEO from "@site/src/components/SEO";

import SetupAWSCognito from "@site/src/common/guides/_setup-aws-cognito.mdx";
import SetupWeb3AuthDashboard from "@site/src/common/guides/_setup-web3auth-dashboard.mdx";
import Web3AuthPrerequisites from "@site/src/common/guides/_web3auth-prerequisites.mdx";

<SEO
  title="Integrate AWS Cognito with Web3Auth"
  description="Learn how to use Web3Auth with AWS Cognito in your React Application."
  image="https://web3auth.io/docs/guides-banners/cognito.png"
  slug="/guides/cognito"
/>

This guide will cover how to integrate AWS Cognito with Web3Auth using the new Web3Auth v10
hooks-based approach. You'll learn how to set up both services for seamless authentication and
wallet creation.

## Quick Start

```bash
npx degit Web3Auth/web3auth-pnp-examples/custom-authentication/single-connection/cognito-example w3a-cognito-demo && cd w3a-cognito-demo && npm install && npm run dev
```

## How it works?

<Tabs
defaultValue="implicit"
values={[
  { label: "Implicit Flow", value: "implicit" },
  { label: "Authorization Code Flow", value: "authcode" },
]}
>
<TabItem value="implicit">

When integrating Web3Auth with AWS Cognito, the Implicit flow looks like this:

![AWS Cognito - Implicit Flow](/guides/cognito/cognito-implicit.png)

</TabItem>
<TabItem value="authcode">

When integrating Web3Auth with AWS Cognito, the Authorization code flow looks like this:

![AWS Cognito - Authorization Code Flow](/guides/cognito/cognito-authcode.png)

For Authorization code flow, you will need an additional backend server to communicate with AWS
Cognito to get the `id_token` in exchange for `authorization_code` received.

</TabItem>

</Tabs>

- When a user logs in with AWS Cognito, Cognito sends a JWT `id_token` to the app. This JWT token is
  sent to the Web3Auth SDK's login function.

- On successful validation of the JWT token, Web3Auth generates a private key for the user in a
  self-custodial way, resulting in easy onboarding for your user to the application.

## Prerequisites

<Web3AuthPrerequisites />

- An [AWS](https://aws.amazon.com/console) account to create an AWS Cognito User Pool.

- A [Google Developer](https://console.developers.google.com) account to be used as an Identity
  provider for AWS Cognito.

## Setup

### Set up AWS Cognito

<SetupAWSCognito />

### Setup Web3Auth

<SetupWeb3AuthDashboard />

#### Setup AWS Cognito Custom Connection

To use AWS Cognito with Web3Auth, you need to create a custom connection:

1. Navigate to the **Custom Connections** tab in the
   [Web3Auth Dashboard](https://dashboard.web3auth.io).
2. Click on the **Settings** icon near the **AWS Cognito** connection.
3. Enter a **Cognito Connection ID** (e.g., "w3a-cognito-demo").
4. Paste the JWKS Endpoint URL:
   `https://cognito-idp.{REGION}.amazonaws.com/{USER_POOL_ID}/.well-known/jwks.json`
5. Paste a sample JWT token to auto-populate the validations (optional).
6. Select the JWT user identifier: `email`, `sub`, or `custom`.
7. Add custom validations:
   - Field: `iss`, Value: `https://cognito-idp.{REGION}.amazonaws.com/{USER_POOL_ID}`
   - Field: `aud`, Value: `{APP_CLIENT_ID}`
8. Click on **Add Connection**.

> Note: Replace `{REGION}`, `{USER_POOL_ID}`, and `{APP_CLIENT_ID}` with your specific Cognito
> details.

## Using Web3Auth with AWS Cognito

### Installation

Install the required dependencies:

```bash
# Core Web3Auth packages
npm install @web3auth/modal

# For blockchain interactions
npm install wagmi viem @tanstack/react-query
```

### Setting up Web3Auth Provider

First, create a configuration file for Web3Auth (e.g., `web3authContext.tsx`):

```tsx
import { WEB3AUTH_NETWORK, type Web3AuthOptions } from "@web3auth/modal";

// Get your client ID from https://dashboard.web3auth.io
const clientId = import.meta.env.VITE_WEB3AUTH_CLIENT_ID || "";

// Instantiate SDK
const web3AuthOptions: Web3AuthOptions = {
  clientId,
  web3AuthNetwork: WEB3AUTH_NETWORK.SAPPHIRE_MAINNET,
};

const web3AuthContextConfig = {
  web3AuthOptions,
};

export default web3AuthContextConfig;
```

Then set up the Web3Auth provider in your application:

```tsx
import React from "react";
import ReactDOM from "react-dom/client";
// Setup Web3Auth Provider
import { Web3AuthProvider } from "@web3auth/modal/react";
import web3AuthContextConfig from "./web3authContext";
// Setup Wagmi Provider for blockchain interactions
import { WagmiProvider } from "@web3auth/modal/react/wagmi";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

import App from "./App";

const queryClient = new QueryClient();

ReactDOM.createRoot(document.getElementById("root") as HTMLElement).render(
  <React.StrictMode>
    <Web3AuthProvider config={web3AuthContextConfig}>
      <QueryClientProvider client={queryClient}>
        <WagmiProvider>
          <App />
        </WagmiProvider>
      </QueryClientProvider>
    </Web3AuthProvider>
  </React.StrictMode>,
);
```

### Implementing Cognito Authentication

In your main application component, use Web3Auth hooks for authentication:

```tsx
import "./App.css";
import { useWeb3AuthConnect, useWeb3AuthDisconnect, useWeb3AuthUser } from "@web3auth/modal/react";
import { WALLET_CONNECTORS, AUTH_CONNECTION } from "@web3auth/modal";
import { useAccount } from "wagmi";
import { SendTransaction } from "./components/sendTransaction";
import { Balance } from "./components/getBalance";
import { SwitchChain } from "./components/switchNetwork";

function App() {
  const { connectTo, isConnected, connectorName } = useWeb3AuthConnect();
  const { disconnect } = useWeb3AuthDisconnect();
  const { userInfo } = useWeb3AuthUser();
  const { address } = useAccount();

  const loginWithCognito = async () => {
    await connectTo(WALLET_CONNECTORS.AUTH, {
      authConnection: AUTH_CONNECTION.CUSTOM,
      authConnectionId: "w3a-cognito-demo", // Your Connection ID from Web3Auth Dashboard
      extraLoginOptions: {
        clientId: import.meta.env.VITE_COGNITO_CLIENT_ID,
        domain: "https://your-cognito-domain.auth.region.amazoncognito.com",
        verifierIdField: "email",
        response_type: "token",
        scope: "email profile openid",
      },
    });
  };

  function uiConsole(...args: any[]): void {
    const el = document.querySelector("#console>p");
    if (el) {
      el.innerHTML = JSON.stringify(args || {}, null, 2);
      console.log(...args);
    }
  }

  const loggedInView = (
    <>
      <h2>Connected to {connectorName}</h2>
      <div>Address: {address}</div>
      <div className="flex-container">
        <div>
          <button onClick={() => uiConsole(userInfo)} className="card">
            Get User Info
          </button>
        </div>
        <div>
          <button onClick={() => disconnect()} className="card">
            Log Out
          </button>
        </div>
      </div>
      <SendTransaction />
      <Balance />
      <SwitchChain />
    </>
  );

  const unloggedInView = (
    <div className="flex-container">
      <button onClick={loginWithCognito} className="card">
        Login with Cognito
      </button>
    </div>
  );

  return (
    <div className="container">
      <h1 className="title">
        <a target="_blank" href="https://web3auth.io/docs" rel="noreferrer">
          Web3Auth{" "}
        </a>
        & AWS Cognito Integration
      </h1>

      <div className="grid">{isConnected ? loggedInView : unloggedInView}</div>
      <div id="console" style={{ whiteSpace: "pre-line" }}>
        <p style={{ whiteSpace: "pre-line" }}></p>
      </div>

      <footer className="footer">
        <a
          href="https://github.com/Web3Auth/web3auth-pnp-examples/tree/main/custom-authentication/single-connection/cognito-example"
          target="_blank"
          rel="noopener noreferrer"
        >
          Source code
        </a>
      </footer>
    </div>
  );
}

export default App;
```

### Interacting with the Blockchain

With Web3Auth v10, blockchain interactions are simplified using the wagmi hooks. Here are examples
of components you can use:

#### Getting Balance

```tsx
// components/getBalance.tsx
import { useAccount, useBalance } from "wagmi";
import { formatUnits } from "viem";

export function Balance() {
  const { address } = useAccount();
  const { data, isLoading, error } = useBalance({ address });

  return (
    <div>
      <h2>Balance</h2>
      <div>
        {data?.value !== undefined && `${formatUnits(data.value, data.decimals)} ${data.symbol}`}
        {isLoading && "Loading..."}
        {error && "Error: " + error.message}
      </div>
    </div>
  );
}
```

#### Sending Transactions

```tsx
// components/sendTransaction.tsx
import { FormEvent } from "react";
import { useWaitForTransactionReceipt, useSendTransaction, BaseError } from "wagmi";
import { Hex, parseEther } from "viem";

export function SendTransaction() {
  const { data: hash, error, isPending, sendTransaction } = useSendTransaction();

  async function submit(e: FormEvent<HTMLFormElement>) {
    e.preventDefault();
    const formData = new FormData(e.target as HTMLFormElement);
    const to = formData.get("address") as Hex;
    const value = formData.get("value") as string;
    sendTransaction({ to, value: parseEther(value) });
  }

  const { isLoading: isConfirming, isSuccess: isConfirmed } = useWaitForTransactionReceipt({
    hash,
  });

  return (
    <div>
      <h2>Send Transaction</h2>
      <form onSubmit={submit}>
        <input name="address" placeholder="Address" required />
        <input name="value" placeholder="Amount (ETH)" type="number" step="0.000000001" required />
        <button disabled={isPending} type="submit">
          {isPending ? "Confirming..." : "Send"}
        </button>
      </form>
      {hash && <div>Transaction Hash: {hash}</div>}
      {isConfirming && "Waiting for confirmation..."}
      {isConfirmed && "Transaction confirmed."}
      {error && <div>Error: {(error as BaseError).shortMessage || error.message}</div>}
    </div>
  );
}
```

#### Switching Networks

```tsx
// components/switchNetwork.tsx
import { useChainId, useSwitchChain } from "wagmi";

export function SwitchChain() {
  const chainId = useChainId();
  const { chains, switchChain, error } = useSwitchChain();

  return (
    <div>
      <h2>Switch Chain</h2>
      <h3>Connected to {chainId}</h3>
      {chains.map((chain) => (
        <button
          disabled={chainId === chain.id}
          key={chain.id}
          onClick={() => switchChain({ chainId: chain.id })}
          type="button"
        >
          {chain.name}
        </button>
      ))}
      {error?.message}
    </div>
  );
}
```

## Authorization Code Flow Setup (Advanced)

For the Authorization code flow, you need a backend server to exchange the authorization code for an
ID token:

1. Select `Authorization code grant` from **Allowed OAuth Flows** in your AWS Cognito Console's App
   client settings.
2. Add callback URLs for both your backend and frontend.
3. For login, direct users to:
   ```
   https://{YOUR_DOMAIN}.auth.{region}.amazoncognito.com/oauth2/authorize?
     response_type=code&
     client_id={CLIENT_ID_FROM_AWS}&
     redirect_uri=https://{YOUR_BACKEND}/callback&
     state=STATE&
     scope=openid+profile+aws.cognito.signin.user.admin
   ```
4. In your backend server, exchange the code for tokens:

   ```js
   app.get("/callback", (req, res) => {
     const options = {
       method: "POST",
       url: "https://{YOUR_DOMAIN}.auth.{REGION}.amazoncognito.com/oauth2/token",
       headers: {
         "content-type": "application/x-www-form-urlencoded",
         Authorization:
           "Basic " +
           Buffer.from(CLIENT_ID_FROM_AWS + ":" + CLIENT_SECRET_FROM_AWS).toString("base64"),
       },
       form: {
         grant_type: "authorization_code",
         client_id: "CLIENT_ID_FROM_AWS",
         code: req.query.code,
         redirect_uri: "https://{YOUR_FRONTEND_URL}",
       },
     };

     request(options, function (error, response, data) {
       const id_token = JSON.parse(data)["id_token"];
       const redirect_url = "http://{YOUR_FRONTEND_URL}?token=" + id_token;
       res.redirect(redirect_url);
     });
   });
   ```

5. In your frontend, connect to Web3Auth with the ID token:
   ```js
   await connectTo(WALLET_CONNECTORS.AUTH, {
     authConnection: AUTH_CONNECTION.CUSTOM,
     authConnectionId: "w3a-cognito-demo",
     idToken: "YOUR_ID_TOKEN_FROM_QUERY_PARAM",
     extraLoginOptions: {
       verifierIdField: "sub",
     },
   });
   ```

## Example code

The code for the application we developed in this guide can be found in the
[Web3Auth Cognito Example](https://github.com/Web3Auth/web3auth-pnp-examples/tree/main/custom-authentication/single-connection/cognito-example).
Check it out and try running it locally yourself!

## Questions?

Ask us on [Web3Auth's Community Support Portal](https://web3auth.io/community)
